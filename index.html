<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#111111" />
  <title>PIA-r√§knare</title>
  <style>
    :root{
      --bg:#0f1115; --card:#151923; --muted:#9aa3b2; --text:#eef2ff;
      --line:#252b3a; --accent:#7aa2ff; --bad:#ff6b6b; --good:#3ddc97;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --r:16px;
      --pad:14px;
      --max:980px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:linear-gradient(180deg,#0d0f14 0%, #0f1115 50%, #0b0d12 100%);
      color:var(--text); font-family:var(--font);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(15,17,21,.85); backdrop-filter:saturate(140%) blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:var(--max); margin:0 auto; padding:12px 12px 18px}
    .titleRow{display:flex; gap:12px; align-items:center; justify-content:space-between}
    h1{font-size:18px; margin:0; letter-spacing:.2px}
    .sub{font-size:12px; color:var(--muted); margin-top:2px}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px solid var(--line);
      border-radius:999px; background:rgba(21,25,35,.7);
      color:var(--text); font-size:12px;
    }
    .pill b{font-weight:600}
    .grid{display:grid; gap:12px}
    @media (min-width:760px){ .grid{grid-template-columns: 1.1fr .9fr} }

    .card{
      background:rgba(21,25,35,.82);
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .cardHead{
      padding:12px var(--pad);
      border-bottom:1px solid var(--line);
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .cardHead h2{font-size:14px; margin:0}
    .cardHead .hint{font-size:12px; color:var(--muted); margin-top:2px}
    .cardBody{padding:12px var(--pad)}
    label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
    input, select, button{
      font:inherit;
    }
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#0e1118;
      color:var(--text);
      outline:none;
    }
    input:focus, select:focus{border-color:rgba(122,162,255,.8); box-shadow:0 0 0 3px rgba(122,162,255,.15)}
    .row{display:grid; gap:10px}
    @media (min-width:520px){ .row{grid-template-columns: 1fr 1.6fr 1fr} }
    .row2{display:grid; gap:10px}
    @media (min-width:520px){ .row2{grid-template-columns: 1fr 1fr} }

    .btnRow{display:flex; flex-wrap:wrap; gap:10px; margin-top:10px}
    button{
      border:1px solid var(--line);
      background:#121726;
      color:var(--text);
      padding:12px 12px;
      border-radius:12px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    button.primary{background:linear-gradient(180deg,#2a4cff 0%, #1730b8 100%); border-color:rgba(122,162,255,.55)}
    button.danger{background:linear-gradient(180deg,#ff4d4d 0%, #b21f1f 100%); border-color:rgba(255,107,107,.55)}
    button.ghost{background:transparent}
    button:active{transform:translateY(1px)}
    .tiny{font-size:12px; color:var(--muted); line-height:1.4}
    .kpi{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px;
    }
    .kpi .box{
      background:#0e1118; border:1px solid var(--line); border-radius:14px;
      padding:12px;
    }
    .kpi .box .lbl{color:var(--muted); font-size:12px}
    .kpi .box .val{font-size:18px; margin-top:4px; font-weight:650}
    .kpi .box .val small{font-size:12px; color:var(--muted); font-weight:500}

    .list{
      display:flex; flex-direction:column; gap:8px; margin-top:10px;
      max-height:52vh; overflow:auto; padding-right:2px;
    }
    .item{
      display:grid; grid-template-columns: 1fr auto; gap:10px;
      background:#0e1118; border:1px solid var(--line); border-radius:14px;
      padding:10px 10px;
      align-items:center;
    }
    .item .meta{display:flex; flex-direction:column; gap:4px}
    .item .meta .top{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
    .tag{
      font-size:11px; color:var(--muted);
      border:1px solid var(--line);
      padding:2px 8px; border-radius:999px;
      background:rgba(21,25,35,.55);
      white-space:nowrap;
    }
    .num{
      font-weight:750; font-size:16px;
    }
    .muted{color:var(--muted)}
    .hr{height:1px; background:var(--line); margin:10px 0}
    details{border-top:1px solid var(--line)}
    summary{
      list-style:none; cursor:pointer; padding:12px var(--pad);
      display:flex; align-items:center; justify-content:space-between;
      user-select:none;
    }
    summary::-webkit-details-marker{display:none}
    .sumLeft{display:flex; flex-direction:column; gap:2px}
    .sumLeft b{font-size:13px}
    .sumLeft span{font-size:12px; color:var(--muted)}
    .sumRight{display:flex; align-items:center; gap:10px}
    .sumRight .tot{font-weight:750}
    .chev{color:var(--muted)}
    .footerPad{height:18px}
    .warn{
      padding:8px 10px; border-radius:12px;
      border:1px dashed rgba(255,107,107,.6);
      background:rgba(255,107,107,.08);
      color:#ffd7d7; font-size:12px; line-height:1.35;
      margin-top:10px;
    }
    .ok{
      padding:8px 10px; border-radius:12px;
      border:1px dashed rgba(61,220,151,.55);
      background:rgba(61,220,151,.08);
      color:#d6fff0; font-size:12px; line-height:1.35;
      margin-top:10px;
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="titleRow">
      <div>
        <h1>PIA-r√§knare</h1>
        <div class="sub">Offline; autosparar lokalt i mobilen/datorn</div>
      </div>
      <div class="pill" id="savePill" title="Autosparstatus">
        <b id="saveState">Sparad</b><span class="muted" id="saveTime">‚Äì</span>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">

    <!-- Inmatning -->
    <section class="card">
      <div class="cardHead">
        <div>
          <h2>Registrera post</h2>
          <div class="hint">V√§lj datum, omr√•de, skriv ett v√§rde (1‚Äì3 siffror); tryck L√§gg till</div>
        </div>
      </div>
      <div class="cardBody">
        <div class="row">
          <div>
            <label for="date">Datum</label>
            <input id="date" type="date" />
          </div>
          <div>
            <label for="area">Omr√•de</label>
            <select id="area"></select>
          </div>
          <div>
            <label for="value">V√§rde</label>
            <input id="value" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="t.ex. 12" />
          </div>
        </div>

        <div class="btnRow">
          <button class="primary" id="addBtn">L√§gg till</button>
          <button class="ghost" id="wakeBtn" title="F√∂rs√∂ker h√•lla sk√§rmen vaken d√§r webbl√§saren st√∂djer det">H√•ll sk√§rmen vaken: AV</button>
          <button class="ghost" id="exportBtn">Exportera CSV (Excel)</button>
        </div>

        <div class="row2" style="margin-top:10px">
          <div>
            <label for="filterDate">Filter: datum</label>
            <input id="filterDate" type="date" />
          </div>
          <div>
            <label for="filterArea">Filter: omr√•de</label>
            <select id="filterArea"></select>
          </div>
        </div>

        <div class="list" id="list"></div>

        <div class="warn" id="iosNote" style="display:none">
          OBS: iOS/Safari kan ibland ignorera varningsrutor vid st√§ngning/omladdning. Appen autosparar √§nd√•, s√• inget f√∂rsvinner √§ven om sk√§rmen l√•ser.
        </div>
      </div>
    </section>

    <!-- Summering -->
    <section class="card">
      <div class="cardHead">
        <div>
          <h2>Summering</h2>
          <div class="hint">Summering per omr√•de; l√§ngst ned totalen f√∂r allt</div>
        </div>
        <div class="sumRight">
          <span class="tag" id="countTag">0 poster</span>
        </div>
      </div>
      <div class="cardBody">

        <div class="kpi">
          <div class="box">
            <div class="lbl">Total PIA</div>
            <div class="val" id="grandTotal">0 <small>st</small></div>
          </div>
          <div class="box">
            <div class="lbl">Unika datum</div>
            <div class="val" id="uniqueDates">0 <small>st</small></div>
          </div>
        </div>

        <div class="hr"></div>

        <div id="areaTotals"></div>

        <div class="hr"></div>

        <div class="btnRow">
          <button class="danger" id="clearBtn" title="Raderar allt lokalt sparat">Rensa all data</button>
          <button class="ghost" id="sampleBtn" title="L√§gger in ett par exempelrader">L√§gg in testdata</button>
        </div>

        <div class="tiny" style="margin-top:10px">
          Exportformat: <span class="muted">Datum;Omr√•de;Fl√∂de;V√§rde</span> (semikolon, passar Excel i svensk milj√∂).
        </div>

        <div class="ok" id="wakeInfo" style="display:none"></div>
      </div>

      <details>
        <summary>
          <div class="sumLeft">
            <b>Tips</b>
            <span>Snabb anv√§ndning i produktion</span>
          </div>
          <div class="chev">‚ñº</div>
        </summary>
        <div class="cardBody" style="padding-top:0">
          <ul class="tiny" style="margin:0; padding-left:18px">
            <li>S√§tt datum en g√•ng; l√§gg sedan bara till v√§rden.</li>
            <li>Sk√§rml√•s √§r OK: allt autosparas och finns kvar n√§r du l√•ser upp.</li>
            <li>‚ÄúH√•ll sk√§rmen vaken‚Äù fungerar i vissa Android/Chrome-l√§gen; iOS st√∂d √§r begr√§nsat.</li>
            <li>Excel-diagram: importera CSV och g√∂r pivot/diagram per omr√•de och datum.</li>
          </ul>
        </div>
      </details>
    </section>

  </div>
  <div class="footerPad"></div>
</main>

<script>
(() => {
  // ====== Konfiguration ======
  const AREAS = [
    { stage: "Efter formning, inf√∂r limning",        flow: "Fl√∂de 1 Limhjul" },
    { stage: "Efter formning, inf√∂r limning",        flow: "Fl√∂de 2 Byr√•+ H-lim" },

    { stage: "Efter formning inf√∂r bearbetning",     flow: "Fl√∂de 1 Limhjul" },
    { stage: "Efter formning inf√∂r bearbetning",     flow: "Fl√∂de 2 Byr√•+ H-lim" },

    { stage: "Efter bearbetning inf√∂r limning",      flow: "Fl√∂de 1 Limhjul" },
    { stage: "Efter bearbetning inf√∂r limning",      flow: "Fl√∂de 2 Byr√•+ H-lim" },

    { stage: "Efter limning, inf√∂r fr√§sning",        flow: "Fl√∂de 1 Limhjul" },
    { stage: "Efter limning, inf√∂r fr√§sning",        flow: "Fl√∂de 2 Byr√•+ H-lim" },

    { stage: "Efter fr√§sning inf√∂r montering",       flow: "Fl√∂de 1 Limhjul" },
    { stage: "Efter fr√§sning inf√∂r montering",       flow: "Fl√∂de 2 Byr√•+ H-lim" },

    { stage: "Efter fr√§sning inf√∂r lastning",        flow: "Fl√∂de 1 Limhjul" },
    { stage: "Efter fr√§sning inf√∂r lastning",        flow: "Fl√∂de 2 Byr√•+ H-lim" },
  ].map((a, idx) => ({ ...a, id: String(idx+1).padStart(2,"0") }));

  const STORE_KEY = "pia_app_v1";
  const $ = (id) => document.getElementById(id);

  const elDate = $("date");
  const elArea = $("area");
  const elValue = $("value");
  const elAdd = $("addBtn");
  const elList = $("list");
  const elFilterDate = $("filterDate");
  const elFilterArea = $("filterArea");
  const elTotals = $("areaTotals");
  const elGrandTotal = $("grandTotal");
  const elUniqueDates = $("uniqueDates");
  const elCountTag = $("countTag");
  const elExport = $("exportBtn");
  const elClear = $("clearBtn");
  const elSample = $("sampleBtn");
  const elSaveState = $("saveState");
  const elSaveTime = $("saveTime");
  const elWakeBtn = $("wakeBtn");
  const elWakeInfo = $("wakeInfo");
  const elIosNote = $("iosNote");

  // ====== Data ======
  /** @type {{ id:string, ts:number, date:string, areaId:string, value:number }[]} */
  let entries = [];
  let wakeLock = null;

  function nowIsoDate() {
    const d = new Date();
    const pad = (n) => String(n).padStart(2,"0");
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  }

  function areaLabel(areaId) {
    const a = AREAS.find(x => x.id === areaId);
    if (!a) return "Ok√§nt omr√•de";
    return `${a.stage} ‚Äî ${a.flow}`;
  }

  function setSavedUI(stateText) {
    elSaveState.textContent = stateText;
    const t = new Date();
    const hh = String(t.getHours()).padStart(2,"0");
    const mm = String(t.getMinutes()).padStart(2,"0");
    const ss = String(t.getSeconds()).padStart(2,"0");
    elSaveTime.textContent = `${hh}:${mm}:${ss}`;
  }

  function load() {
    try {
      const raw = localStorage.getItem(STORE_KEY);
      entries = raw ? JSON.parse(raw) : [];
      if (!Array.isArray(entries)) entries = [];
    } catch {
      entries = [];
    }
    setSavedUI("Sparad");
  }

  function save() {
    try {
      localStorage.setItem(STORE_KEY, JSON.stringify(entries));
      setSavedUI("Sparad");
    } catch {
      setSavedUI("Ej sparad");
      alert("Kunde inte spara lokalt. Kontrollera lagringsutrymme i webbl√§saren.");
    }
  }

  function sanitizeValue(v) {
    const s = String(v ?? "").trim();
    if (!/^\d{1,3}$/.test(s)) return null;
    const n = Number(s);
    if (!Number.isFinite(n)) return null;
    return n;
  }

  function uid() {
    return (crypto?.randomUUID?.() || `id_${Date.now()}_${Math.random().toString(16).slice(2)}`);
  }

  function addEntry() {
    const date = elDate.value || nowIsoDate();
    const areaId = elArea.value;
    const value = sanitizeValue(elValue.value);
    if (!date) return alert("V√§lj datum.");
    if (!areaId) return alert("V√§lj omr√•de.");
    if (value === null) return alert("V√§rde m√•ste vara 1‚Äì3 siffror (0‚Äì999).");

    entries.push({ id: uid(), ts: Date.now(), date, areaId, value });
    save();
    elValue.value = "";
    elValue.focus();
    render();
  }

  function deleteEntry(id) {
    const ix = entries.findIndex(e => e.id === id);
    if (ix >= 0) {
      entries.splice(ix, 1);
      save();
      render();
    }
  }

  function clearAll() {
    const ok = confirm("Rensa all data? Detta g√•r inte att √•ngra.");
    if (!ok) return;
    entries = [];
    save();
    render();
  }

  function addSample() {
    if (entries.length > 0) {
      const ok = confirm("Det finns redan data. L√§gga till testdata √§nd√•?");
      if (!ok) return;
    }
    const d = nowIsoDate();
    const pick = (id, val, offDays=0) => {
      const dt = new Date(d);
      dt.setDate(dt.getDate()+offDays);
      const dd = dt.toISOString().slice(0,10);
      entries.push({ id: uid(), ts: Date.now(), date: dd, areaId: id, value: val });
    };
    pick("01", 12, 0);
    pick("02", 9, 0);
    pick("07", 18, 1);
    pick("10", 6, 1);
    save();
    render();
  }

  function getFilteredEntries() {
    const fd = elFilterDate.value;
    const fa = elFilterArea.value;
    return entries
      .filter(e => !fd || e.date === fd)
      .filter(e => !fa || e.areaId === fa)
      .sort((a,b) => b.ts - a.ts);
  }

  function computeTotals() {
    const totalsByArea = new Map(); // areaId -> sum
    let grand = 0;
    const dates = new Set();

    for (const e of entries) {
      totalsByArea.set(e.areaId, (totalsByArea.get(e.areaId) || 0) + e.value);
      grand += e.value;
      dates.add(e.date);
    }
    return { totalsByArea, grand, uniqueDates: dates.size };
  }

  function renderList() {
    const list = getFilteredEntries();
    if (list.length === 0) {
      elList.innerHTML = `<div class="tiny muted">Inga poster f√∂r filtret.</div>`;
      return;
    }

    const html = list.map(e => {
      const a = AREAS.find(x => x.id === e.areaId);
      const stage = a?.stage || "Ok√§nt";
      const flow = a?.flow || "Ok√§nt";
      return `
        <div class="item">
          <div class="meta">
            <div class="top">
              <span class="tag">${e.date}</span>
              <span class="tag">${flow}</span>
            </div>
            <div class="muted" style="font-size:12px; line-height:1.25">${stage}</div>
          </div>
          <div style="display:flex; align-items:center; gap:10px">
            <div class="num">${e.value}</div>
            <button class="ghost" data-del="${e.id}" title="Radera">üóëÔ∏è</button>
          </div>
        </div>
      `;
    }).join("");

    elList.innerHTML = html;

    elList.querySelectorAll("[data-del]").forEach(btn => {
      btn.addEventListener("click", () => deleteEntry(btn.getAttribute("data-del")));
    });
  }

  function renderTotals() {
    const { totalsByArea, grand, uniqueDates } = computeTotals();
    elGrandTotal.innerHTML = `${grand} <small>st</small>`;
    elUniqueDates.innerHTML = `${uniqueDates} <small>st</small>`;
    elCountTag.textContent = `${entries.length} poster`;

    // Sortera totals: h√∂gst f√∂rst
    const rows = AREAS
      .map(a => ({ a, sum: totalsByArea.get(a.id) || 0 }))
      .sort((x,y) => y.sum - x.sum);

    const html = rows.map(({a,sum}) => `
      <div class="item" style="grid-template-columns: 1fr auto">
        <div class="meta">
          <div class="top">
            <span class="tag">${a.flow}</span>
          </div>
          <div class="muted" style="font-size:12px; line-height:1.25">${a.stage}</div>
        </div>
        <div class="num">${sum}</div>
      </div>
    `).join("");

    elTotals.innerHTML = html || `<div class="tiny muted">Ingen data √§n.</div>`;
  }

  function render() {
    renderList();
    renderTotals();
  }

  function populateSelects() {
    // Area select
    elArea.innerHTML = AREAS.map(a =>
      `<option value="${a.id}">${a.stage} ‚Äî ${a.flow}</option>`
    ).join("");

    // Filter area select
    elFilterArea.innerHTML = `<option value="">(alla)</option>` + AREAS.map(a =>
      `<option value="${a.id}">${a.stage} ‚Äî ${a.flow}</option>`
    ).join("");
  }

  // ====== Export CSV ======
  function toCsvSemicolon(rows) {
    const esc = (s) => {
      const str = String(s ?? "");
      // Excel + semikolon: om inneh√•ller ; " eller radbrytning, citera och dubbla "
      if (/[;"\n\r]/.test(str)) return `"${str.replaceAll('"','""')}"`;
      return str;
    };
    return rows.map(r => r.map(esc).join(";")).join("\r\n");
  }

  function exportCsv() {
    // Exportera ALLA entries (inte filter) f√∂r Excel-diagram/pivot.
    const header = ["Datum","Omr√•de","Fl√∂de","V√§rde"];
    const rows = entries
      .slice()
      .sort((a,b) => a.date.localeCompare(b.date) || a.areaId.localeCompare(b.areaId) || (a.ts-b.ts))
      .map(e => {
        const a = AREAS.find(x => x.id === e.areaId);
        return [e.date, a?.stage ?? "", a?.flow ?? "", e.value];
      });

    const csv = toCsvSemicolon([header, ...rows]);
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    const stamp = new Date().toISOString().slice(0,19).replaceAll(":","-");
    a.href = url;
    a.download = `PIA_${stamp}.csv`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 2000);
  }

  // ====== F√∂rhindra oavsiktlig st√§ngning / omladdning ======
  // OBS: iOS/Safari kan ignorera detta ibland; autosave g√∂r att data √§nd√• √§r kvar.
  let hasUnsaved = false;

  function markDirty() {
    hasUnsaved = true;
    elSaveState.textContent = "Sparar‚Ä¶";
  }

  // Vi sparar direkt vid √§ndring av entries, s√• "dirty" √§r mest f√∂r varningsruta.
  window.addEventListener("beforeunload", (e) => {
    // Alltid varna (√∂nskem√•l), men vissa browsers visar endast generisk text.
    e.preventDefault();
    e.returnValue = "";
    return "";
  });

  // F√∂rs√∂k minska "back" som r√•kar l√§mna sidan
  (function lockHistory() {
    try {
      history.pushState({ pia: true }, "", location.href);
      window.addEventListener("popstate", () => {
        // triggas n√§r anv√§ndaren f√∂rs√∂ker backa ut
        const ok = confirm("L√§mna sidan? (Data √§r sparad, men du kan r√•ka st√§nga arbetet.)");
        if (!ok) history.pushState({ pia: true }, "", location.href);
      });
    } catch {}
  })();

  // ====== Wake Lock (h√•ll sk√§rmen vaken) ======
  async function toggleWakeLock() {
    const supported = "wakeLock" in navigator;
    if (!supported) {
      elWakeInfo.style.display = "block";
      elWakeInfo.textContent = "Wake Lock st√∂ds inte i denna webbl√§sare. Appen autosparar √§nd√• n√§r sk√§rmen l√•ser.";
      return;
    }
    try {
      if (wakeLock) {
        await wakeLock.release();
        wakeLock = null;
        elWakeBtn.textContent = "H√•ll sk√§rmen vaken: AV";
        elWakeInfo.style.display = "none";
      } else {
        wakeLock = await navigator.wakeLock.request("screen");
        elWakeBtn.textContent = "H√•ll sk√§rmen vaken: P√Ö";
        elWakeInfo.style.display = "block";
        elWakeInfo.textContent = "Sk√§rmen f√∂rs√∂ker h√•llas vaken s√• l√§nge sidan √§r aktiv. Om du byter app kan den st√§ngas av automatiskt.";
        wakeLock.addEventListener("release", () => {
          wakeLock = null;
          elWakeBtn.textContent = "H√•ll sk√§rmen vaken: AV";
        });
      }
    } catch (err) {
      elWakeInfo.style.display = "block";
      elWakeInfo.textContent = "Kunde inte aktivera Wake Lock (kan kr√§va anv√§ndargester eller https). Appen autosparar √§nd√•.";
    }
  }

  document.addEventListener("visibilitychange", async () => {
    // Om sidan blir synlig igen och wake lock var p√•, f√∂rs√∂k √•teraktivera
    if (document.visibilityState === "visible" && wakeLock === null && elWakeBtn.textContent.includes("P√Ö")) {
      try { wakeLock = await navigator.wakeLock.request("screen"); } catch {}
    }
  });

  // ====== Init ======
  function detectIOS() {
    const ua = navigator.userAgent || "";
    return /iPad|iPhone|iPod/.test(ua) || (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);
  }

  function init() {
    populateSelects();
    load();

    const today = nowIsoDate();
    if (!elDate.value) elDate.value = today;
    elFilterDate.value = ""; // default: inga filter

    render();

    elAdd.addEventListener("click", addEntry);
    elValue.addEventListener("keydown", (e) => {
      if (e.key === "Enter") addEntry();
    });

    elFilterDate.addEventListener("change", render);
    elFilterArea.addEventListener("change", render);

    elExport.addEventListener("click", exportCsv);
    elClear.addEventListener("click", clearAll);
    elSample.addEventListener("click", addSample);

    elWakeBtn.addEventListener("click", toggleWakeLock);

    // iOS-note
    if (detectIOS()) elIosNote.style.display = "block";
  }

  init();
})();
</script>
</body>
</html>
