<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Vilja √§r b√§st!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=no" />
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #ffddff 0, #111 65%);
      color: #fff;
    }

    body.shake {
      animation: shake 0.4s linear;
    }

    body.spin {
      animation: spin 1s linear;
    }

    body.invert {
      filter: invert(1) hue-rotate(180deg);
    }

    #game {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    #status {
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 12px;
      background: rgba(0,0,0,0.5);
      border-radius: 999px;
      font-size: 14px;
      text-align: center;
      max-width: 90%;
      z-index: 20;
    }

    #viljaButton {
      position: absolute;
      padding: 18px 30px;
      border-radius: 999px;
      border: none;
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(135deg, #ff00ff, #ffea00);
      color: #111;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      cursor: pointer;
      transform: translate(-50%, -50%);
      transition: transform 0.05s linear, filter 0.1s ease, opacity 0.2s ease;
      touch-action: none;
      z-index: 10;
    }

    #viljaButton.tiny {
      transform: translate(-50%, -50%) scale(0.6);
    }

    #viljaButton.huge {
      transform: translate(-50%, -50%) scale(1.5);
    }

    #viljaButton.hiddenBtn {
      opacity: 0;
      pointer-events: none;
    }

    #winScreen {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px;
      z-index: 100;
    }

    #winScreen.hidden {
      display: none;
    }

    #winScreen h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    #winScreen p {
      margin: 4px 0;
      font-size: 16px;
    }

    #winScreen button {
      margin-top: 18px;
      padding: 10px 20px;
      border-radius: 999px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(135deg, #00ffcc, #00aaff);
      color: #111;
      cursor: pointer;
    }

    .tempOverlay {
      position: absolute;
      color: #fff;
      font-weight: 700;
      text-shadow: 0 0 10px rgba(0,0,0,0.7);
      z-index: 30;
      pointer-events: none;
      animation: floatUp 1s ease-out forwards;
    }

    .catOverlay {
      position: absolute;
      inset: 10% 5%;
      border-radius: 20px;
      background: rgba(0,0,0,0.85);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 50;
      animation: fadeInOut 1.5s ease-out forwards;
      pointer-events: none;
      text-align: center;
      padding: 10px;
    }

    .catOverlay span {
      font-size: 40px;
      margin-bottom: 8px;
    }

    .catOverlay p {
      margin: 0;
      font-size: 18px;
    }

    .fakeButton {
      position: absolute;
      padding: 10px 14px;
      border-radius: 30px;
      border: 1px solid rgba(255,255,255,0.5);
      background: rgba(0,0,0,0.5);
      font-size: 12px;
      color: #fff;
      pointer-events: auto;
      z-index: 5;
    }

    .fakeButton:active {
      transform: scale(0.95);
    }

    @keyframes shake {
      0% { transform: translate(0,0); }
      20% { transform: translate(-5px, 4px); }
      40% { transform: translate(4px,-4px); }
      60% { transform: translate(-4px,-2px); }
      80% { transform: translate(3px,4px); }
      100% { transform: translate(0,0); }
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes floatUp {
      from { opacity: 1; transform: translate(-50%, 0); }
      to { opacity: 0; transform: translate(-50%, -60px); }
    }

    @keyframes fadeInOut {
      0% { opacity: 0; transform: scale(0.8); }
      20% { opacity: 1; transform: scale(1); }
      80% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(0.9); }
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="status">F√∂rs√∂k trycka p√• ‚ÄúVilja √§r b√§st!‚Äù-knappen. Lycka till.</div>
    <button id="viljaButton">Vilja √§r b√§st!</button>

    <div id="winScreen" class="hidden">
      <h1>DU KLARADE DET!</h1>
      <p>Du tryckte p√• knappen.</p>
      <p>Bevis: Du √§r officiellt lika om√∂jlig som spelet.</p>
      <p>Vilja √§r b√§st. Och du n√§stan.</p>
      <button id="playAgain">Spela igen</button>
    </div>
  </div>

  <script>
    const game = document.getElementById("game");
    const button = document.getElementById("viljaButton");
    const statusEl = document.getElementById("status");
    const winScreen = document.getElementById("winScreen");
    const playAgainBtn = document.getElementById("playAgain");

    let audioCtx = null;
    let attempts = 0;
    let allowedClick = false; // sl√§pper igenom ibland
    let fakeButtons = [];

    function ensureAudio() {
      if (!audioCtx) {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (AC) {
          audioCtx = new AC();
        }
      }
    }

    function playWeirdBeep(type = "random") {
      ensureAudio();
      if (!audioCtx) return;
      const ctx = audioCtx;

      const osc = ctx.createOscillator();
      const gain = ctx.createGain();

      let freq;
      switch (type) {
        case "fail":
          freq = 120 + Math.random() * 80;
          break;
        case "cat":
          freq = 400 + Math.random() * 200;
          break;
        case "teleport":
          freq = 700 + Math.random() * 600;
          break;
        case "win":
          freq = 500;
          break;
        default:
          freq = 150 + Math.random() * 900;
      }

      osc.frequency.value = freq;
      osc.type = ["sine", "square", "sawtooth", "triangle"][Math.floor(Math.random() * 4)];
      const now = ctx.currentTime;
      gain.gain.setValueAtTime(0.2, now);
      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.25 + Math.random() * 0.1);

      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start(now);
      osc.stop(now + 0.3);
    }

    function placeButtonRandom() {
      const rect = game.getBoundingClientRect();
      const padding = 60;
      const x = padding + Math.random() * (rect.width - padding * 2);
      const y = padding + 60 + Math.random() * (rect.height - padding * 2 - 80);
      button.style.left = x + "px";
      button.style.top = y + "px";
    }

    function moveButtonAway(pointerX, pointerY) {
      const rect = button.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;

      const dx = centerX - pointerX;
      const dy = centerY - pointerY;
      const dist = Math.sqrt(dx * dx + dy * dy) || 1;

      const step = 150 + Math.random() * 120;
      const nx = centerX + (dx / dist) * step;
      const ny = centerY + (dy / dist) * step;

      const gameRect = game.getBoundingClientRect();
      let newX = Math.min(Math.max(nx, gameRect.left + 40), gameRect.right - 40);
      let newY = Math.min(Math.max(ny, gameRect.top + 80), gameRect.bottom - 40);

      button.style.left = newX + "px";
      button.style.top = newY + "px";
      playWeirdBeep("teleport");
    }

    function pointerNearButton(ev) {
      const rect = button.getBoundingClientRect();
      const x = ev.clientX;
      const y = ev.clientY;
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const dist = Math.sqrt((centerX - x) ** 2 + (centerY - y) ** 2);
      return dist < 120;
    }

    function handlePointerMove(ev) {
      if (winScreen.classList.contains("hidden") === false) return;
      if (pointerNearButton(ev)) {
        moveButtonAway(ev.clientX, ev.clientY);
        attempts++;
        statusEl.textContent = weirdStatusText();
      }
    }

    function weirdStatusText() {
      const msgs = [
        "Miss igen. Knappen tycker inte om dig.",
        "Spelet: 1 000 000, du: 0.",
        "Tips: Ge upp. (Fast inte p√• riktigt.)",
        "Vilja skrattar √•t dina f√∂rs√∂k just nu.",
        "Knappen √§r allergisk mot fingrar.",
        "Den h√§r rundan var en tr√§ningsrunda.",
        "Ny taktik: tryck snabbare √§n spelet hinner t√§nka."
      ];
      return msgs[Math.floor(Math.random() * msgs.length)];
    }

    function tempText(text, x, y) {
      const div = document.createElement("div");
      div.className = "tempOverlay";
      div.textContent = text;
      div.style.left = x + "px";
      div.style.top = y + "px";
      game.appendChild(div);
      setTimeout(() => div.remove(), 1000);
    }

    function showCatOverlay() {
      const div = document.createElement("div");
      div.className = "catOverlay";
      const span = document.createElement("span");
      span.textContent = "üòº";
      const p = document.createElement("p");
      const lines = [
        "Katten Lo blockerar knappen.",
        "Du m√•ste klia katten f√∂rst.",
        "Mjau. Inga klick h√§r."
      ];
      p.textContent = lines[Math.floor(Math.random() * lines.length)];
      div.appendChild(span);
      div.appendChild(p);
      game.appendChild(div);
      playWeirdBeep("cat");
      setTimeout(() => div.remove(), 1500);
    }

    function randomScreenEffect() {
      const r = Math.random();
      if (r < 0.2) {
        // Skaka
        document.body.classList.add("shake");
        playWeirdBeep("fail");
        setTimeout(() => document.body.classList.remove("shake"), 400);
      } else if (r < 0.4) {
        // Spin
        document.body.classList.add("spin");
        playWeirdBeep();
        setTimeout(() => document.body.classList.remove("spin"), 1000);
      } else if (r < 0.55) {
        // Invert
        document.body.classList.add("invert");
        setTimeout(() => document.body.classList.remove("invert"), 600);
      } else if (r < 0.7) {
        // Katt
        showCatOverlay();
      } else if (r < 0.85) {
        // Falska knappar
        spawnFakeButton();
      } else {
        // Knappen blir mini eller mega eller f√∂rsvinner kort
        const mode = Math.floor(Math.random() * 3);
        if (mode === 0) {
          button.classList.remove("huge");
          button.classList.add("tiny");
        } else if (mode === 1) {
          button.classList.remove("tiny");
          button.classList.add("huge");
        } else {
          button.classList.add("hiddenBtn");
          setTimeout(() => button.classList.remove("hiddenBtn"), 700);
        }
      }
    }

    function spawnFakeButton() {
      // rensa gamla ibland
      if (fakeButtons.length > 6) {
        const b = fakeButtons.shift();
        b.remove();
      }
      const rect = game.getBoundingClientRect();
      const fb = document.createElement("button");
      fb.className = "fakeButton";
      const texts = [
        "Fel knapp",
        "Inte den h√§r",
        "N√§stan r√§tt",
        "Tryck inte h√§r",
        "Definitivt fel"
      ];
      fb.textContent = texts[Math.floor(Math.random() * texts.length)];
      const x = 10 + Math.random() * (rect.width - 100);
      const y = 60 + Math.random() * (rect.height - 120);
      fb.style.left = x + "px";
      fb.style.top = y + "px";
      fb.addEventListener("click", (e) => {
        e.stopPropagation();
        playWeirdBeep("fail");
        tempText("HAHA, fel knapp.", e.clientX, e.clientY);
      });
      game.appendChild(fb);
      fakeButtons.push(fb);
    }

    function maybeAllowClick() {
      // Efter ett antal f√∂rs√∂k b√∂rjar det ibland sl√§ppa igenom klick
      const baseChance = 0.01; // 1 %
      const bonus = Math.min(attempts / 2000, 0.25); // max +25 %
      const chance = baseChance + bonus;
      allowedClick = Math.random() < chance;
    }

    function win() {
      winScreen.classList.remove("hidden");
      playWeirdBeep("win");
      statusEl.textContent = "Du vann. Spelet √§r brutet.";
    }

    function resetGame() {
      attempts = 0;
      allowedClick = false;
      statusEl.textContent = "Ny runda. F√∂rs√∂k trycka p√• knappen.";
      winScreen.classList.add("hidden");
      fakeButtons.forEach(b => b.remove());
      fakeButtons = [];
      placeButtonRandom();
    }

    // Hantera f√∂rs√∂k att klicka sj√§lva knappen
    button.addEventListener("pointerdown", (ev) => {
      ensureAudio();
      ev.preventDefault();
      attempts++;

      maybeAllowClick();

      if (allowedClick) {
        win();
        return;
      }

      playWeirdBeep("fail");
      tempText("NOPE!", ev.clientX, ev.clientY);
      moveButtonAway(ev.clientX, ev.clientY);
      statusEl.textContent = weirdStatusText();
    });

    // Flytta sig n√§r fingret √§r n√§ra
    game.addEventListener("pointermove", handlePointerMove);

    // Extra: tryck utanf√∂r knappen = lite h√•n
    game.addEventListener("pointerdown", (ev) => {
      if (ev.target === button || winScreen.contains(ev.target)) return;
      ensureAudio();
      attempts++;
      playWeirdBeep();
      if (Math.random() < 0.4) {
        tempText("Det d√§r var inte ens n√§ra.", ev.clientX, ev.clientY);
      }
    });

    // Random effekter
    setInterval(() => {
      if (winScreen.classList.contains("hidden")) {
        randomScreenEffect();
      }
    }, 1500);

    // Spela igen
    playAgainBtn.addEventListener("click", () => {
      ensureAudio();
      resetGame();
    });

    // Init
    window.addEventListener("load", () => {
      placeButtonRandom();
    });

    window.addEventListener("resize", () => {
      placeButtonRandom();
    });
  </script>
</body>
</html>