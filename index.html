<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Change Journey – CDC Board (Touch)</title>
<style>
    :root {
        --blue-header: #c7d7f5;
        --blue-footer: #c3d2eb;
        --board-bg: #082446;
        --cdc-width: 260px;
    }

    * {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #e7edf8;
    }

    .app {
        display: flex;
        height: 100vh;
    }

    /* PALETTE */

    .palette {
        width: 280px;
        background: #f4f4f8;
        padding: 12px;
        border-right: 1px solid #d0d0dd;
        overflow-y: auto;
    }

    .palette h2 {
        font-size: 16px;
        margin: 0 0 8px;
    }

    .palette-section-title {
        font-size: 12px;
        font-weight: 600;
        margin: 12px 0 4px;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        color: #555;
    }

    .palette-item {
        margin-bottom: 12px;
        cursor: grab;
        touch-action: none;
    }

    .hint {
        font-size: 11px;
        color: #666;
        margin-top: 4px;
        line-height: 1.3;
    }

    /* BOARD / TIMELINE */

    .board-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .board-header {
        padding: 10px 16px;
        background: linear-gradient(to right, #11284d, #1b3a70);
        color: white;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .board-header-title {
        font-size: 16px;
        font-weight: 600;
    }

    .board {
        flex: 1;
        background: var(--board-bg);
        padding: 16px;
        overflow: auto;
    }

    .timeline-label {
        color: #f3f5ff;
        font-size: 12px;
        margin-bottom: 6px;
        text-transform: uppercase;
        letter-spacing: 0.06em;
    }

    .timeline {
        min-height: 260px;
        border-radius: 10px;
        border: 2px dashed rgba(255,255,255,0.4);
        padding: 10px;
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
        gap: 10px;
    }

    .timeline.drag-over {
        border-style: solid;
        background: radial-gradient(circle at top left,
            rgba(255,255,255,0.1),
            rgba(0,0,0,0));
    }

    /* GENERELLT DRAGGBART */

    .draggable {
        cursor: grab;
        touch-action: none; /* viktigt för iPhone */
    }

    .dragging-ghost {
        position: fixed;
        z-index: 9999;
        pointer-events: none;
        opacity: 0.85;
        transform: translate(-50%, -50%);
    }

    /* CDC CARD */

    .cdc-card {
        width: var(--cdc-width);
        background: #fdfdfd;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        border-top: 4px solid var(--blue-header);
        padding-bottom: 4px;
        font-size: 11px;
    }

    .cdc-header {
        background: var(--blue-header);
        padding: 4px 6px 2px;
        border-radius: 4px 4px 0 0;
        display: grid;
        grid-template-columns: 80px 1fr 32px;
        column-gap: 4px;
        align-items: center;
    }

    .cdc-title {
        grid-column: 1 / 4;
        text-align: center;
        font-size: 11px;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .cdc-type {
        background: #148a3a;
        color: #fff;
        border-radius: 5px;
        padding: 10px 4px;
        font-size: 10px;
        text-align: center;
        text-transform: uppercase;
        font-weight: 600;
    }

    .cdc-type[contenteditable="true"],
    .cdc-content[contenteditable="true"],
    .cdc-topic[contenteditable="true"],
    .cdc-benefit[contenteditable="true"],
    .payoff-label[contenteditable="true"],
    .arrow-text[contenteditable="true"],
    .comm-text[contenteditable="true"],
    .comm-meta[contenteditable="true"],
    .cdc-circle[contenteditable="true"],
    .cdc-time[contenteditable="true"] {
        outline: none;
    }

    .cdc-content {
        background: #f9fafc;
        border-radius: 5px;
        padding: 6px 4px;
        min-height: 28px;
        border: 1px dashed #c0cadf;
        color: #555;
        font-size: 10px;
        text-align: center;
    }

    .cdc-meta {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-size: 9px;
    }

    .cdc-circle {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid #d6403b;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 2px;
        background: #fff;
    }

    .cdc-time {
        font-size: 9px;
    }

    .cdc-body {
        padding: 6px;
    }

    .cdc-label {
        font-size: 9px;
        font-weight: 600;
        margin-bottom: 2px;
    }

    .cdc-topic {
        min-height: 42px;
        padding: 4px;
        border-radius: 2px;
        background: #ffffff;
        border: 1px solid #eee;
        margin-bottom: 4px;
    }

    .cdc-dashed {
        border-top: 2px dashed #e04848;
        margin: 4px 0;
    }

    .cdc-benefit {
        min-height: 32px;
        padding: 4px;
        border-radius: 2px;
        background: #ffffff;
        border: 1px solid #eee;
        margin-top: 2px;
    }

    .cdc-footer {
        background: var(--blue-footer);
        padding: 4px 6px;
        border-radius: 0 0 4px 4px;
        display: grid;
        grid-template-columns: 1.4fr 1.6fr;
        column-gap: 2px;
        align-items: flex-start;
    }

    .payoff-left,
    .payoff-right {
        font-size: 9px;
    }

    .payoff-left-title {
        font-weight: 600;
        margin-bottom: 2px;
    }

    .payoff-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .payoff-dot {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        border: 1px solid #666;
        background: #fff;
    }

    .payoff-label {
        flex: 1;
    }

    .payoff-box {
        height: 10px;
        border-radius: 2px;
        background: #fff;
        border: 1px solid #9ca9c3;
        margin-bottom: 2px;
    }

    /* RED ARROW */

    .arrow-card {
        width: 180px;
        height: 60px;
        background: #d83434;
        color: #fff;
        font-weight: 600;
        font-size: 12px;
        position: relative;
        clip-path: polygon(0 0, 80% 0, 100% 50%, 80% 100%, 0 100%);
        display: flex;
        align-items: center;
        padding-left: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.25);
    }

    .arrow-text {
        width: 80%;
    }

    /* COMM BLOCK */

    .comm-card {
        width: 200px;
        height: 90px;
        background: #fdfdfd;
        border: 2px solid #b9bcc5;
        border-radius: 4px;
        padding: 4px 6px;
        font-size: 10px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }

    .comm-header {
        font-weight: 600;
        font-size: 10px;
        margin-bottom: 2px;
    }

    .comm-text {
        flex: 1;
        padding: 3px;
        border: 1px dashed #ccc;
        background: #ffffff;
        border-radius: 2px;
    }

    .comm-meta {
        text-align: right;
        font-size: 9px;
        color: #555;
    }
</style>
</head>
<body>
<div class="app">
    <!-- Palette -->
    <aside class="palette">
        <h2>Templates</h2>
        <div class="hint">
            Dra ett kort eller en pil till tidslinjen. All text på korten kan ändras direkt.
        </div>

        <div class="palette-section-title">CDC card</div>
        <div class="palette-item" data-template-id="tpl-cdc">
            <div class="cdc-card">
                <div class="cdc-header">
                    <div class="cdc-title">Change Development</div>
                    <div class="cdc-type">Coaching</div>
                    <div class="cdc-content">Content</div>
                    <div class="cdc-meta">
                        <div class="cdc-circle">1</div>
                        <div class="cdc-time">1h</div>
                    </div>
                </div>
                <div class="cdc-body">
                    <div class="cdc-label">Topic / learning goal</div>
                    <div class="cdc-topic">Write topic here…</div>
                    <div class="cdc-dashed"></div>
                    <div class="cdc-label">benefit</div>
                    <div class="cdc-benefit"></div>
                </div>
                <div class="cdc-footer">
                    <div class="payoff-left">
                        <div class="payoff-left-title">Pay off:</div>
                        <div class="payoff-item">
                            <div class="payoff-dot"></div><span class="payoff-label">knowledge</span>
                        </div>
                        <div class="payoff-item">
                            <div class="payoff-dot"></div><span class="payoff-label">behavior</span>
                        </div>
                        <div class="payoff-item">
                            <div class="payoff-dot"></div><span class="payoff-label">attitude</span>
                        </div>
                    </div>
                    <div class="payoff-right">
                        <div>emotions</div>
                        <div class="payoff-box"></div>
                        <div>thoughts</div>
                        <div class="payoff-box"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="palette-section-title">Focus arrow</div>
        <div class="palette-item" data-template-id="tpl-arrow">
            <div class="arrow-card">
                <div class="arrow-text">New chapter</div>
            </div>
        </div>

        <div class="palette-section-title">Communication block</div>
        <div class="palette-item" data-template-id="tpl-comm">
            <div class="comm-card">
                <div class="comm-header">Communication block</div>
                <div class="comm-text">
                    e.g. Email before training, info to manager…
                </div>
                <div class="comm-meta">Before / after CDC</div>
            </div>
        </div>

        <div class="hint">
            Tips: När korten ligger på tidslinjen kan du dra dem för att byta plats.
        </div>
    </aside>

    <!-- Board -->
    <div class="board-wrapper">
        <div class="board-header">
            <div class="board-header-title">Change Journey Timeline</div>
            <div style="font-size:11px;">Dra kort hit från vänster.</div>
        </div>
        <div class="board">
            <div class="timeline-label">Approx. 6 months journey</div>
            <div class="timeline" id="timeline"></div>
        </div>
    </div>
</div>

<!-- TEMPLATES (osynliga) -->
<template id="tpl-cdc">
    <div class="cdc-card draggable" data-kind="cdc">
        <div class="cdc-header">
            <div class="cdc-title">Change Development</div>
            <div class="cdc-type" contenteditable="true">Coaching</div>
            <div class="cdc-content" contenteditable="true">Content</div>
            <div class="cdc-meta">
                <div class="cdc-circle" contenteditable="true">1</div>
                <div class="cdc-time" contenteditable="true">1h</div>
            </div>
        </div>
        <div class="cdc-body">
            <div class="cdc-label">Topic / learning goal</div>
            <div class="cdc-topic" contenteditable="true">I am able to work with…</div>
            <div class="cdc-dashed"></div>
            <div class="cdc-label">benefit</div>
            <div class="cdc-benefit" contenteditable="true"></div>
        </div>
        <div class="cdc-footer">
            <div class="payoff-left">
                <div class="payoff-left-title">Pay off:</div>
                <div class="payoff-item">
                    <div class="payoff-dot"></div><span class="payoff-label" contenteditable="true">knowledge</span>
                </div>
                <div class="payoff-item">
                    <div class="payoff-dot"></div><span class="payoff-label" contenteditable="true">behavior</span>
                </div>
                <div class="payoff-item">
                    <div class="payoff-dot"></div><span class="payoff-label" contenteditable="true">attitude</span>
                </div>
            </div>
            <div class="payoff-right">
                <div>emotions</div>
                <div class="payoff-box"></div>
                <div>thoughts</div>
                <div class="payoff-box"></div>
            </div>
        </div>
    </div>
</template>

<template id="tpl-arrow">
    <div class="arrow-card draggable" data-kind="arrow">
        <div class="arrow-text" contenteditable="true">Awareness</div>
    </div>
</template>

<template id="tpl-comm">
    <div class="comm-card draggable" data-kind="comm">
        <div class="comm-header">Communication block</div>
        <div class="comm-text" contenteditable="true">
            Email to teamleader: invite and explain purpose…
        </div>
        <div class="comm-meta" contenteditable="true">Before CDC</div>
    </div>
</template>

<script>
(function() {
    const timeline = document.getElementById('timeline');
    const paletteItems = document.querySelectorAll('.palette-item');

    let dragState = null; // {source: 'palette'|'board', templateId?, element?, ghost?, x, y}

    function isInsideContentEditable(target) {
        return !!target.closest('[contenteditable="true"]');
    }

    function createId() {
        return 'card-' + Math.random().toString(36).slice(2);
    }

    function setupPalette() {
        paletteItems.forEach(item => {
            item.addEventListener('pointerdown', e => {
                if (isInsideContentEditable(e.target)) return;
                e.preventDefault();
                startDragFromPalette(item, e);
            });
        });
    }

    function startDragFromPalette(item, e) {
        dragState = {
            source: 'palette',
            templateId: item.dataset.templateId,
            startX: e.clientX,
            startY: e.clientY,
            ghost: null
        };
        document.body.setPointerCapture(e.pointerId);
    }

    function startDragFromBoard(element, e) {
        dragState = {
            source: 'board',
            element: element,
            startX: e.clientX,
            startY: e.clientY,
            ghost: null
        };
        document.body.setPointerCapture(e.pointerId);
    }

    function createGhostFromElement(el, x, y) {
        const rect = el.getBoundingClientRect();
        const ghost = el.cloneNode(true);
        ghost.classList.add('dragging-ghost');
        ghost.style.width = rect.width + 'px';
        ghost.style.height = rect.height + 'px';
        ghost.style.left = x + 'px';
        ghost.style.top = y + 'px';
        document.body.appendChild(ghost);
        return ghost;
    }

    function onPointerMove(e) {
        if (!dragState) return;

        const x = e.clientX;
        const y = e.clientY;
        dragState.x = x;
        dragState.y = y;

        if (!dragState.ghost) {
            let sourceEl;
            if (dragState.source === 'palette') {
                sourceEl = dragStateFromPalettePreview(dragState.templateId);
            } else {
                sourceEl = dragState.element;
            }
            dragState.ghost = createGhostFromElement(sourceEl, x, y);
        } else {
            dragState.ghost.style.left = x + 'px';
            dragState.ghost.style.top = y + 'px';
        }
    }

    function dragStateFromPalettePreview(templateId) {
        const paletteItem = Array.from(paletteItems)
            .find(p => p.dataset.templateId === templateId);
        return paletteItem.firstElementChild;
    }

    function onPointerUp(e) {
        if (!dragState) return;

        const x = dragState.x ?? e.clientX;
        const y = dragState.y ?? e.clientY;

        if (dragState.ghost) {
            dragState.ghost.remove();
        }

        const rect = timeline.getBoundingClientRect();
        const inside =
            x >= rect.left && x <= rect.right &&
            y >= rect.top && y <= rect.bottom;

        if (inside) {
            if (dragState.source === 'palette') {
                const tpl = document.getElementById(dragState.templateId);
                if (tpl) {
                    const node = tpl.content.firstElementChild.cloneNode(true);
                    node.id = createId();
                    makeBoardDraggable(node);
                    insertAtPosition(node, x);
                }
            } else if (dragState.source === 'board') {
                insertAtPosition(dragState.element, x);
            }
        }

        dragState = null;
    }

    function insertAtPosition(node, x) {
        const children = Array.from(timeline.children);
        if (children.length === 0) {
            timeline.appendChild(node);
            return;
        }

        // hitta plats baserat på x-position
        let inserted = false;
        for (let child of children) {
            const r = child.getBoundingClientRect();
            const centerX = r.left + r.width / 2;
            if (x < centerX) {
                timeline.insertBefore(node, child);
                inserted = true;
                break;
            }
        }
        if (!inserted) {
            timeline.appendChild(node);
        }
    }

    function makeBoardDraggable(node) {
        node.classList.add('draggable');
        node.addEventListener('pointerdown', e => {
            if (isInsideContentEditable(e.target)) return;
            e.preventDefault();
            startDragFromBoard(node, e);
        });
    }

    // global lyssnare
    window.addEventListener('pointermove', onPointerMove);
    window.addEventListener('pointerup', onPointerUp);

    // init palette
    setupPalette();
})();
</script>
</body>
</html>